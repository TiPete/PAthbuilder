<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Pathbuilder v1.0</title>
    <link rel="stylesheet" href="css/styles.css?v=1.0">
<script>
    class Hero {
        constructor(){
            this.stats=[0,0,0,0,0,0];
        }
    } // Contains all the character's data 
    function DisplayDesc(val) {
        var desc = document.getElementById("abilityScoreMethodDesc");
        
        var metStandard= "<p>Roll 4d6, discard the lowest die result, and add the three remaining results together. Record this total and repeat the process until six numbers are generated.</p><p>Assign these totals to your ability scores as you see fit.</p><p>This method is less random than Classic and tends to create characters with above-average ability scores.</p>";
        
        var metClassic= "<p>Roll 3d6 and add the dice together. Record this total and repeat the process until you generate six numbers. Assign these results to your ability scores as you see fit.</p><p>This method is quite random, and some characters will have clearly superior abilities.</p><p>This randomness can be taken one step further, with the totals applied to specific ability scores in the order they are rolled. Characters generated using this method are difficult to fit to predetermined concepts, as their scores might not support given classes or personalities, and instead are best designed around their ability scores.</p>";
        
        var metHeroic= "<p>Roll 2d6 and add 6 to the sum of the dice. Record this total and repeat the process until six numbers are generated.<p></p>Assign these totals to your ability scores as you see fit.</p><p>This is less random than the Standard method and generates characters with mostly above-average scores.</p>";
        
        var metDicePool= "Each character has a pool of 24d6 to assign to his statistics. Before the dice are rolled, the player selects the number of dice to roll for each score, with a minimum of 3d6 for each ability.</p><p>Once the dice have been assigned, the player rolls each group and totals the result of the three highest dice. For more high-powered games, the GM should increase the total number of dice to 28.</p><p>This method generates characters of a similar power to the Standard method.</p>";
        
        var metPurchase= "<p>Each character receives a number of points to spend on increasing his basic attributes.</p><p>In this method, all attributes start at a base of 10. A character can increase an individual score by spending some of his points. Likewise, he can gain more points to spend on other scores by decreasing one or more of his ability scores. No score can be reduced below 7 or raised above 18 using this method</p><p>After all the points are spent, apply any racial modifiers the character might have.</p><p>The number of points you have to spend using the purchase method depends on the type of campaign you are playing. The standard value for a character is 15 points. Average nonplayer characters (NPCs) are typically built using as few as 3 points.</p><p>The purchase method emphasizes player choice and creates equally balanced characters.</p>";
        
        var metManualEntry= "<p>Manually enter each stat.</p>"
        
        switch(val) {
            case "standard": desc.innerHTML= metStandard; break;
            case "classic": desc.innerHTML= metClassic; break;
            case "heroic": desc.innerHTML= metHeroic; break;
            case "dicePool": desc.innerHTML= metDicePool; break;
            case "purchase": desc.innerHTML= metPurchase; break;
            case "manual": desc.innerHTML= metManualEntry; break;
            }
    } //Display the ability score method description
    function ConfirmStatsMethod(){
        document.getElementById("ChooseStatsMethod").style.display = "none";
        switch (document.getElementById("abilityScoreMethod").value){
            case "standard": StatsStandard(); break;
            case "classic":  StatsClassic(); break;
            case "heroic": StatsHeroic(); break;
            case "dicePool": document.getElementById("DicePoolMethod").style.display = "block"; break;
            case "purchase": document.getElementById("PMEnterBudget").style.display = "block"; break;
            case "manual": document.getElementById("ManualEntryMethod").style.display = "block"; break;
        }
    } //Activate the chosen stats rolling method 
    function StatsClassic() {
        var roll= new Array(3);
        var i, j;
        for (i = 0; i < 6; i++) {
            for (j = 0; j < 3; j++){
                roll[j]= Math.floor(Math.random() * 6) + 1;
            }
            rollResults[i]= (roll[0] + roll[1] + roll[2]);
        }
        AssignStats();
    } // Rolls stats according to the classic method
    function StatsStandard() {
        var roll= new Array(4);
        var i, j;
        for (i = 0; i < 6; i++) {
            for (j = 0; j < 4; j++){
                roll[j]= Math.floor(Math.random() * 6) + 1;
            }
            roll.sort();
            rollResults[i]= (roll[1] + roll[2] + roll[3]);
        }
        AssignStats();
    } // Rolls stats according to the standard method
    function StatsHeroic() {
            var roll= new Array(2);
            var i, j;
            for (i = 0; i < 6; i++) {
                for (j = 0; j < 2; j++){
                    roll[j]= Math.floor(Math.random() * 6) + 1;
                }
            rollResults[i]= (roll[0] + roll[1] + 6);
            }
            AssignStats();
        } // Rolls stats according to the standard method   
    function DicePool() {
        document.getElementById("DicePool").style.display = "block";    
    } // Rolls stats according to the dice poll method   
    function DPup(stat) {
        if (nbrDices > 0){
            poolDices[stat]++; 
            nbrDices--; 
        } else {
            alert("No more dices");
        }
        UpdateDPDisplay(stat);
    } // Rise the number of dices  
    function DPdown(stat) {
        if (poolDices[stat] > 3){
            poolDices[stat]--; 
            nbrDices++;  
        } else {
            alert("Minimum amount of dices: 3");
        }
        UpdateDPDisplay(stat);
    } // Lowers the number of dices
    function UpdateDPDisplay() {
        document.getElementById("DPPool").innerHTML = nbrDices;
        for (i = 0; i < 6; i++){
            document.getElementById(i + "DPDisplay").innerHTML = poolDices[i];
        }
        if (nbrDices == 0){
            document.getElementById("DPAccept").disabled = false;
        } else {
            document.getElementById("DPAccept").disabled = true;
        }
   
    } //Update the dice pool display 
    function RollDPStats(){
        document.getElementById("DicePoolMethod").style.display = "none";
        function DPRoll(nb){
            var rolls = new Array(nb);
            for (i = 0; i < nb; i++){
                for (k = 0; k < nb; k++){
                    rolls[k]=Math.floor(Math.random() * 6) + 1;
                }
                rolls.sort();
                return (rolls[--nb] + rolls[--nb] + rolls[--nb]);
            }
        }
        for (j = 0; j < 6; j++){
                hero.stats[j] = DPRoll(poolDices[j]);
            }
    document.getElementById("ChooseRace").style.display = "block";
    } //Roll the stats according to the Dice Pool method
    function PurchaseMethod() {
        for (i = 0; i < 6; i++){
            hero.stats[i] = 10;
        }
        PMBudget = document.getElementById("PMBudgetInput").value;
        document.getElementById("PMEnterBudget").style.display= "none";
        document.getElementById("PMPts").innerHTML= PMBudget;
        document.getElementById("PurchaseMethod").style.display= "block";
    } //Determine the points budget for the purchase method
    function CalculateCost() {
        var usedPts = 0;
        for (i = 0; i < 6; i++){
            switch (hero.stats[i]) {
                case 7: usedPts -= 4; break;
                case 8: usedPts -= 2; break;
                case 9: usedPts -= 1; break;
                case 10: break;
                case 11: usedPts += 1; break;
                case 12: usedPts += 2; break;
                case 13: usedPts += 3; break;
                case 14: usedPts += 5; break;
                case 15: usedPts += 7; break;
                case 16: usedPts += 10; break;
                case 17: usedPts += 13; break;
                case 18: usedPts += 17; break;
            }
        }
        return usedPts;
    } // Calculate the cost of the purchase
    function CalculateModifier(stat) {
        return -5 + parseInt(hero.stats[stat]/2);
    } // Calculate the stats modifier
    function PurchaseUpdate(stat, upDown) {
        if (hero.stats[stat] > 7 && !upDown){
            hero.stats[stat]--;
        } else {
            if (hero.stats[stat] < 18 && upDown){
                hero.stats[stat]++;
                if (CalculateCost() > PMBudget) {
                    hero.stats[stat]--;
                }
            }
        }
        console.log(CalculateCost());
        var currentBudget = parseInt(PMBudget) - parseInt(CalculateCost());
        document.getElementById("PMPts").innerHTML = currentBudget;
        for (i = 0; i < 6; i++){
            document.getElementById("pStatDisplay" + i).innerHTML = hero.stats[i];
            document.getElementById("pModifierDisplay" + i).innerHTML = DisplayModifier(i);
        }
    } //Update the stats purchase display
    function FinalizePurchase() {
        document.getElementById("PurchaseMethod").style.display= "none";
        document.getElementById("ChooseRace").style.display= "block";
    } // Finalize the the stats purchase method
    function DisplayModifier(stat){
        var mod = CalculateModifier(stat);
        if (mod == 0){
            return "-";
        } else if (mod > 0){
            return ("+" + mod);
        } else {
            return mod;
        }
    } // Returns the modifier with - or +
    function UpdateAssignStats(){
        var dom = "";
        var nbRestants = rollResults.length;
        for (i = 0; i < 6; i++){
            switch (i){
                case 0: dom += "Strength :"; break;
                case 1: dom += "Dexterity :"; break;
                case 2: dom += "Constitution :"; break;
                case 3: dom += "Intelligence :"; break;
                case 4: dom += "Wisdom :"; break;
                case 5: dom += "Charisma :"; break;
            }
            if (hero.stats[i] == 0){
                dom += "<select onChange=\"AssignRollToStat(" + i +", this.value)\">";
                dom += "<option value=\"blank\">   </option>";
                for (j = 0; j < nbRestants; j++){
                    dom += "<option value=\""+ j + "\">"+rollResults[j]+"</option>";
                }
                dom += "</select></p>";
            } else {
                dom += "<span id=\"assignedStat" + i + "\">" + hero.stats[i] + "</span>";
                dom += " (" + DisplayModifier(i) + ") ";
                dom += " <button id=\"clearAssignedStat" + i + "\" onclick=\"ClearAssignedStat(" + i + ")\">Clear</button></p>";
            }
        }
        if (nbRestants == 0){
            dom += "<button id=\"ConfirmAssignStat\" onclick=\"FinalizeAssignStats()\">Confirm</button>";
        } else {
            dom += "<button id=\"ConfirmAssignStat\" disabled>Confirm</button>";
        }
        document.getElementById("AssignStats").innerHTML = dom;
    } // Handle the stats assignment process
    function AssignRollToStat(stat, sel){
        hero.stats[stat] = rollResults[sel];
        rollResults.splice(sel, 1);
        UpdateAssignStats();
    } // Assign a roll to a stat
    function AssignStats() {
        document.getElementById("AssignStats").style.display = "block";
        rollResults.sort();
        UpdateAssignStats();
    } //Assign the rolls to stats
    function ClearAssignedStat(stat){
        hero.stats[stat] = 0;
        rollResults.push((parseInt(document.getElementById("assignedStat" + stat).innerText)));
        rollResults.sort();
        UpdateAssignStats();
    } // Clear an assigned stat
    function StatsManualEntry(stat, value){
        hero.stats[stat] = value;
    } //Assign manually entered stat
    function ConfirmManualStats(){
        document.getElementById("ManualEntryMethod").style.display= "none";
        document.getElementById("ChooseRace").style.display= "block";
    } // Confirms the manual entry values
    function FinalizeAssignStats(){
        document.getElementById("AssignStats").style.display= "none";
        document.getElementById("ChooseRace").style.display= "block";
    }
    function DisplayRaceDesc(race){
        switch(race){
            case 1: var descRace = "Dwarf"; break;
            case 2: var descRace = "Elf"; break;
            case 3: var descRace = "Gnome"; break;
            case 4: var descRace = "Half elf"; break;
            case 5: var descRace = "Half orc"; break;
            case 6: var descRace = "Halfling"; break;
            case 7: var descRace = "Human"; break;
        }
        console.log(descRace);
        document.getElementById("RaceDescription").innerHTML = descRace;
        if (race == 0){
            document.getElementById("ConfirmRace").disabled= true;
        } else {
            document.getElementById("ConfirmRace").disabled= false;
        }
    }
    </script>
    
</head>

<body>
<script>
    var hero = new Hero();
    var poolDices = [3, 3, 3, 3, 3, 3];
    var nbrDices = 6, PMBudget = 0, rollResults=[0,0,0,0,0,0], 
        assignedStats= new Array(6);
</script> <!--  Initialize global variants -->
<h1>Welcome to Pathbuilder</h1>


<!-- The Modal -->
<div id="myModal" class="modal">
<div class="ChooseStatsMethod" id="ChooseStatsMethod">
    <p>Choose ability score method</p>
    <div class= "abilityScoreMethodsChoice">
    <select id="abilityScoreMethod" onChange="DisplayDesc(this.value)">
        <option value="standard">Standard</option>
        <option value="classic">Classic</option>
        <option value="heroic">Heroic</option>
        <option value="dicePool">Dice pool</option>
        <option value="purchase">Purchase</option>
        <option value="manual">Manual entry</option>
    </select>
    <button onclick="ConfirmStatsMethod()">Confirm</button>
    </div>
    <div id="abilityScoreMethodDesc" class="abilityScoreMethodDesc">
        <p>Roll 4d6, discard the lowest die result, and add the three remaining results together. Record this total and repeat the process until six numbers are generated.</p>
        <p>Assign these totals to your ability scores as you see fit.</p>
        <p>This method is less random than Classic and tends to create characters with above-average ability scores.</p>
    </div>
</div> <!-- Choose stats method -->
<div class="StatsMethod" id="DicePoolMethod">
    <p>Dice Pool Method</p>
        <p>Remaining dices: <span id="DPPool">6</span></p>
        <p>Strength: <span id="0DPDisplay">3</span> <button id="DP0Down" class="DPstrDown" onclick="DPdown(0)">-</button><button id="DPstrUp" class="DPUp" onclick="DPup(0)">+</button></p>
        <p>Dexterity: <span id="1DPDisplay">3</span> <button id="DP1Down" class="DPdexDown" onclick="DPdown(1)">-</button><button id="DPdexUp" class="DPUp" onclick="DPup(1)">+</button></p>
        <p>Constitution: <span id="2DPDisplay">3</span> <button id="DP2Down" class="DPconDown" onclick="DPdown(2)">-</button><button id="DPconUp" class="DPUp" onclick="DPup(2)">+</button></p>
        <p>Intelligence: <span id="3DPDisplay">3</span> <button id="DP3Down" class="DPintDown" onclick="DPdown(3)">-</button><button id="DPintUp" class="DPUp" onclick="DPup(3)">+</button></p>
        <p>Wisdom: <span id="4DPDisplay">3</span> <button id="DP4Down" class="DPwisDown" onclick="DPdown(4)">-</button><button id="DPwisUp" class="DPUp" onclick="DPup(4)">+</button></p>
        <p>Charisma: <span id="5DPDisplay">3</span> <button id="DP5Down" class="DPchaDown" onclick="DPdown(5)">-</button><button id="DPchaUp" class="DPUp" onclick="DPup(5)">+</button></p>
        <p><button id="DPAccept" disabled onclick = "RollDPStats()">Accept</button></p>
    </div> <!-- Roll stats according to the Dice Pool Method -->
<div class="StatsMethod" id="PMEnterBudget">
    <p>Please enter your points budget:</p>
    <input type="number" id="PMBudgetInput" min="1" value="15">
    <button onclick="PurchaseMethod()">Accept</button>
</div> <!-- Determine the points budget -->
<div class="StatsMethod" id="PurchaseMethod">
    <p>Purchase Method</p>
    <p>Remaining points: <span id="PMPts"></span></p>
    <p>strength: 
        <button id="buttonDown0" onclick="PurchaseUpdate(0,0)">-</button>
        <span id="pStatDisplay0">10</span>
        <button id="buttonUp0" onclick="PurchaseUpdate(0,1)">+</button>
        (<span id="pModifierDisplay0">-</span>)
    </p>
        <p>Dexterity: 
        <button id="buttonDown1" onclick="PurchaseUpdate(1,0)">-</button>
        <span id="pStatDisplay1">10</span>
        <button id="buttonUp1" onclick="PurchaseUpdate(1,1)">+</button>
        (<span id="pModifierDisplay1">-</span>)
    </p>
       <p>Constitution: 
        <button id="buttonDown2" onclick="PurchaseUpdate(2,0)">-</button>
        <span id="pStatDisplay2">10</span>
        <button id="buttonUp2" onclick="PurchaseUpdate(2,1)">+</button>
        (<span id="pModifierDisplay2">-</span>)
    </p>
        <p>Intelligence: 
        <button id="buttonDown3" onclick="PurchaseUpdate(3,0)">-</button>
        <span id="pStatDisplay3">10</span>
        <button id="buttonUp3" onclick="PurchaseUpdate(3,1)">+</button>
        (<span id="pModifierDisplay3">-</span>)
    </p>
        <p>Wisdom: 
        <button id="buttonDown4" onclick="PurchaseUpdate(4,0)">-</button>
        <span id="pStatDisplay4">10</span>
        <button id="buttonUp4" onclick="PurchaseUpdate(4,1)">+</button>
        (<span id="pModifierDisplay4">-</span>)
    </p>
        <p>Charisma: 
        <button id="buttonDown5" onclick="PurchaseUpdate(5,0)">-</button>
        <span id="pStatDisplay5">10</span>
        <button id="buttonUp5" onclick="PurchaseUpdate(5,1)">+</button>
        (<span id="pModifierDisplay5">-</span>)
    </p>
    <button id="purchaseAccept" onclick="FinalizePurchase()">Accept</button>
</div> <!-- Stats purchase -->
<div class="StatsMethod" id="ManualEntryMethod">
    Manual Entry Method
    <p>Strength: <input type="number" id="statsManualEntry0" min="3" max="18" value="10" onchange="StatManualEntry(0, this.value)"></p>
    <p>Dexterity: <input type="number" id="statsManualEntry1" min="3" max="18" value="10" onchange="StatManualEntry(1, this.value)"></p>
    <p>Constitution: <input type="number" id="statsManualEntry2" min="3" max="18" value="10" onchange="StatManualEntry(2, this.value)"></p>
    <p>Intelligence: <input type="number" id="statsManualEntry3" min="3" max="18" value="10" onchange="StatManualEntry(3, this.value)"></p>
    <p>Wisdom: <input type="number" id="statsManualEntry4" min="3" max="18" value="10" onchange="StatManualEntry(4, this.value)"></p>
    <p>Charisma: <input type="number" id="statsManualEntry5" min="3" max="18" value="10" onchange="StatManualEntry(5, this.value)"></p>
    <button onclick="ConfirmManualStats()">Confirm</button>
</div> <!-- Stats manual entry -->
<div class="AssignStats" id="AssignStats"></div> <!-- Manually enter stats -->


<!-- ------------------------------------- -->
    
<div class="ChooseRace" id="ChooseRace">
    <p>Choose Race</p>
    <p><select onchange="DisplayRaceDesc(this.value)">
        <option value="blank"></option>
        <option value="1">Dwarf</option>
        <option value="2">Elf</option>
        <option value="3">Gnome</option>
        <option value="4">Half Elf</option>
        <option value="5">Half Orc</option>
        <option value="6">Halfling</option>
        <option value="7">Human</option>
    </select></p>
    <p id="RaceDescription"></p>
    <button id="ConfirmRace" disabled>Confirm</button>
    
</div>

</div> <!-- Modal windows -->

<div id="main" class="main">
    Main Screen !
</div>

<script>




</script>
    
</body>
</html>